import{j as F,E as V}from"./aria-gYNd90_s.js";import{af as Pe,Z as Y,B as ve,n as Ce,p as W,q as te,V as ye,E as Ee,s as ze,ag as Ae,a as C,ah as Be,ai as Me,v as m,H as me,R as Le,I as _e,k as pe,o as g,w as p,b as d,T as Ve,e as k,z as he,x as v,u as e,i as I,c as E,y as x,M as Fe,F as Z,d as Ye,t as Se,S as Xe,j as De,aj as He,A as Ne,a7 as je,ak as qe,a5 as Ke,al as We,P as be,l as Ze,am as ke,an as Ie,a3 as Ge,N as Ue}from"./index-Br7qLbH3.js";import{E as Je,a as Qe}from"./index-BX35VZBE.js";import{_ as Oe,s as ea,q as aa,E as $,d as ta,f as sa,g as na,z as oa,r as la,t as ra,u as ia}from"./index-4xCaf6Pg.js";import{m as Re}from"./typescript-Bp3YSIOJ.js";import{d as ua}from"./isEqual-LPFrB0dG.js";import{u as ca}from"./el-tab-pane-D5QdQcwr.js";import{g as da}from"./scroll-BbotL90k.js";var fa="Expected a function";function fe(i,z,l){var s=!0,o=!0;if(typeof i!="function")throw new TypeError(fa);return Pe(l)&&(s="leading"in l?!!l.leading:s,o="trailing"in l?!!l.trailing:o),ua(i,z,{leading:s,maxWait:z,trailing:o})}const va=(i,z)=>{if(!Y||!i||!z)return!1;const l=i.getBoundingClientRect();let s;return z instanceof Element?s=z.getBoundingClientRect():s={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},l.top<s.bottom&&l.bottom>s.top&&l.right>s.left&&l.left<s.right},ma=Ce({urlList:{type:W(Array),default:()=>Re([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:W(String)}}),pa={close:()=>!0,switch:i=>ve(i),rotate:i=>ve(i)},ga=te({name:"ElImageViewer"}),wa=te({...ga,props:ma,emits:pa,setup(i,{expose:z,emit:l}){var s;const o=i,w={CONTAIN:{name:"contain",icon:ye(aa)},ORIGINAL:{name:"original",icon:ye(ea)}};let X,D="";const{t:se}=Ee(),n=ze("image-viewer"),{nextZIndex:P}=Ae(),L=C(),M=C([]),A=Be(),f=C(!0),y=C(o.initialIndex),O=Me(w.CONTAIN),u=C({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ne=C((s=o.zIndex)!=null?s:P()),H=m(()=>{const{urlList:a}=o;return a.length<=1}),G=m(()=>y.value===0),j=m(()=>y.value===o.urlList.length-1),q=m(()=>o.urlList[y.value]),oe=m(()=>[n.e("btn"),n.e("prev"),n.is("disabled",!o.infinite&&G.value)]),le=m(()=>[n.e("btn"),n.e("next"),n.is("disabled",!o.infinite&&j.value)]),U=m(()=>{const{scale:a,deg:c,offsetX:r,offsetY:b,enableTransition:S}=u.value;let N=r/a,T=b/a;const K=c*Math.PI/180,ge=Math.cos(K),we=Math.sin(K);N=N*ge+T*we,T=T*ge-r/a*we;const de={transform:`scale(${a}) rotate(${c}deg) translate(${N}px, ${T}px)`,transition:S?"transform .3s":""};return O.value.name===w.CONTAIN.name&&(de.maxWidth=de.maxHeight="100%"),de}),J=m(()=>`${y.value+1} / ${o.urlList.length}`);function B(){ee(),X==null||X(),document.body.style.overflow=D,l("close")}function Q(){const a=fe(r=>{switch(r.code){case V.esc:o.closeOnPressEscape&&B();break;case V.space:_();break;case V.left:ue();break;case V.up:R("zoomIn");break;case V.right:ce();break;case V.down:R("zoomOut");break}}),c=fe(r=>{const b=r.deltaY||r.deltaX;R(b<0?"zoomIn":"zoomOut",{zoomRate:o.zoomRate,enableTransition:!1})});A.run(()=>{F(document,"keydown",a),F(document,"wheel",c)})}function ee(){A.stop()}function re(){f.value=!1}function ie(a){f.value=!1,a.target.alt=se("el.image.error")}function t(a){if(f.value||a.button!==0||!L.value)return;u.value.enableTransition=!1;const{offsetX:c,offsetY:r}=u.value,b=a.pageX,S=a.pageY,N=fe(K=>{u.value={...u.value,offsetX:c+K.pageX-b,offsetY:r+K.pageY-S}}),T=F(document,"mousemove",N);F(document,"mouseup",()=>{T()}),a.preventDefault()}function h(){u.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function _(){if(f.value)return;const a=He(w),c=Object.values(w),r=O.value.name,S=(c.findIndex(N=>N.name===r)+1)%a.length;O.value=w[a[S]],h()}function ae(a){const c=o.urlList.length;y.value=(a+c)%c}function ue(){G.value&&!o.infinite||ae(y.value-1)}function ce(){j.value&&!o.infinite||ae(y.value+1)}function R(a,c={}){if(f.value)return;const{minScale:r,maxScale:b}=o,{zoomRate:S,rotateDeg:N,enableTransition:T}={zoomRate:o.zoomRate,rotateDeg:90,enableTransition:!0,...c};switch(a){case"zoomOut":u.value.scale>r&&(u.value.scale=Number.parseFloat((u.value.scale/S).toFixed(3)));break;case"zoomIn":u.value.scale<b&&(u.value.scale=Number.parseFloat((u.value.scale*S).toFixed(3)));break;case"clockwise":u.value.deg+=N,l("rotate",u.value.deg);break;case"anticlockwise":u.value.deg-=N,l("rotate",u.value.deg);break}u.value.enableTransition=T}function Te(a){var c;((c=a.detail)==null?void 0:c.focusReason)==="pointer"&&a.preventDefault()}function $e(){o.closeOnPressEscape&&B()}function xe(a){if(a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}return me(q,()=>{Le(()=>{const a=M.value[0];a!=null&&a.complete||(f.value=!0)})}),me(y,a=>{h(),l("switch",a)}),_e(()=>{Q(),X=F("wheel",xe,{passive:!1}),D=document.body.style.overflow,document.body.style.overflow="hidden"}),z({setActiveItem:ae}),(a,c)=>(g(),pe(e(Qe),{to:"body",disabled:!a.teleported},{default:p(()=>[d(Ve,{name:"viewer-fade",appear:""},{default:p(()=>[k("div",{ref_key:"wrapper",ref:L,tabindex:-1,class:v(e(n).e("wrapper")),style:he({zIndex:ne.value})},[d(e(Je),{loop:"",trapped:"","focus-trap-el":L.value,"focus-start-el":"container",onFocusoutPrevented:Te,onReleaseRequested:$e},{default:p(()=>[k("div",{class:v(e(n).e("mask")),onClick:Fe(r=>a.hideOnClickModal&&B(),["self"])},null,10,["onClick"]),I(" CLOSE "),k("span",{class:v([e(n).e("btn"),e(n).e("close")]),onClick:B},[d(e($),null,{default:p(()=>[d(e(ta))]),_:1})],2),I(" ARROW "),e(H)?I("v-if",!0):(g(),E(Z,{key:0},[k("span",{class:v(e(oe)),onClick:ue},[d(e($),null,{default:p(()=>[d(e(sa))]),_:1})],2),k("span",{class:v(e(le)),onClick:ce},[d(e($),null,{default:p(()=>[d(e(na))]),_:1})],2)],64)),a.$slots.progress||a.showProgress?(g(),E("div",{key:1,class:v([e(n).e("btn"),e(n).e("progress")])},[x(a.$slots,"progress",{activeIndex:y.value,total:a.urlList.length},()=>[Ye(Se(e(J)),1)])],2)):I("v-if",!0),I(" ACTIONS "),k("div",{class:v([e(n).e("btn"),e(n).e("actions")])},[k("div",{class:v(e(n).e("actions__inner"))},[x(a.$slots,"toolbar",{actions:R,prev:ue,next:ce,reset:_,activeIndex:y.value,setActiveItem:ae},()=>[d(e($),{onClick:r=>R("zoomOut")},{default:p(()=>[d(e(oa))]),_:1},8,["onClick"]),d(e($),{onClick:r=>R("zoomIn")},{default:p(()=>[d(e(la))]),_:1},8,["onClick"]),k("i",{class:v(e(n).e("actions__divider"))},null,2),d(e($),{onClick:_},{default:p(()=>[(g(),pe(Xe(e(O).icon)))]),_:1}),k("i",{class:v(e(n).e("actions__divider"))},null,2),d(e($),{onClick:r=>R("anticlockwise")},{default:p(()=>[d(e(ra))]),_:1},8,["onClick"]),d(e($),{onClick:r=>R("clockwise")},{default:p(()=>[d(e(ia))]),_:1},8,["onClick"])])],2)],2),I(" CANVAS "),k("div",{class:v(e(n).e("canvas"))},[(g(!0),E(Z,null,De(a.urlList,(r,b)=>(g(),E(Z,{key:b},[b===y.value?(g(),E("img",{key:0,ref_for:!0,ref:S=>M.value[b]=S,src:r,style:he(e(U)),class:v(e(n).e("img")),crossorigin:a.crossorigin,onLoad:re,onError:ie,onMousedown:t},null,46,["src","crossorigin"])):I("v-if",!0)],64))),128))],2),x(a.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var ya=Oe(wa,[["__file","image-viewer.vue"]]);const ha=Ne(ya),ba=Ce({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:W([String,Object])},previewSrcList:{type:W(Array),default:()=>Re([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:W(String)}}),ka={load:i=>i instanceof Event,error:i=>i instanceof Event,switch:i=>ve(i),close:()=>!0,show:()=>!0},Ia=te({name:"ElImage",inheritAttrs:!1}),Ca=te({...Ia,props:ba,emits:ka,setup(i,{expose:z,emit:l}){const s=i,{t:o}=Ee(),w=ze("image"),X=je(),D=m(()=>qe(Object.entries(X).filter(([t])=>/^(data-|on[A-Z])/i.test(t)||["id","style"].includes(t)))),se=ca({excludeListeners:!0,excludeKeys:m(()=>Object.keys(D.value))}),n=C(),P=C(!1),L=C(!0),M=C(!1),A=C(),f=C(),y=Y&&"loading"in HTMLImageElement.prototype;let O;const u=m(()=>[w.e("inner"),H.value&&w.e("preview"),L.value&&w.is("loading")]),ne=m(()=>{const{fit:t}=s;return Y&&t?{objectFit:t}:{}}),H=m(()=>{const{previewSrcList:t}=s;return Ke(t)&&t.length>0}),G=m(()=>{const{previewSrcList:t,initialIndex:h}=s;let _=h;return h>t.length-1&&(_=0),_}),j=m(()=>s.loading==="eager"?!1:!y&&s.loading==="lazy"||s.lazy),q=()=>{Y&&(L.value=!0,P.value=!1,n.value=s.src)};function oe(t){L.value=!1,P.value=!1,l("load",t)}function le(t){L.value=!1,P.value=!0,l("error",t)}function U(){va(A.value,f.value)&&(q(),Q())}const J=We(U,200,!0);async function B(){var t;if(!Y)return;await Le();const{scrollContainer:h}=s;Ge(h)?f.value=h:Ue(h)&&h!==""?f.value=(t=document.querySelector(h))!=null?t:void 0:A.value&&(f.value=da(A.value)),f.value&&(O=F(f,"scroll",J),setTimeout(()=>U(),100))}function Q(){!Y||!f.value||!J||(O==null||O(),f.value=void 0)}function ee(){H.value&&(M.value=!0,l("show"))}function re(){M.value=!1,l("close")}function ie(t){l("switch",t)}return me(()=>s.src,()=>{j.value?(L.value=!0,P.value=!1,Q(),B()):q()}),_e(()=>{j.value?B():q()}),z({showPreview:ee}),(t,h)=>(g(),E("div",be({ref_key:"container",ref:A},e(D),{class:[e(w).b(),t.$attrs.class]}),[P.value?x(t.$slots,"error",{key:0},()=>[k("div",{class:v(e(w).e("error"))},Se(e(o)("el.image.error")),3)]):(g(),E(Z,{key:1},[n.value!==void 0?(g(),E("img",be({key:0},e(se),{src:n.value,loading:t.loading,style:e(ne),class:e(u),crossorigin:t.crossorigin,onClick:ee,onLoad:oe,onError:le}),null,16,["src","loading","crossorigin"])):I("v-if",!0),L.value?(g(),E("div",{key:1,class:v(e(w).e("wrapper"))},[x(t.$slots,"placeholder",{},()=>[k("div",{class:v(e(w).e("placeholder"))},null,2)])],2)):I("v-if",!0)],64)),e(H)?(g(),E(Z,{key:2},[M.value?(g(),pe(e(ha),{key:0,"z-index":t.zIndex,"initial-index":e(G),infinite:t.infinite,"zoom-rate":t.zoomRate,"min-scale":t.minScale,"max-scale":t.maxScale,"show-progress":t.showProgress,"url-list":t.previewSrcList,crossorigin:t.crossorigin,"hide-on-click-modal":t.hideOnClickModal,teleported:t.previewTeleported,"close-on-press-escape":t.closeOnPressEscape,onClose:re,onSwitch:ie},Ze({toolbar:p(_=>[x(t.$slots,"toolbar",ke(Ie(_)))]),default:p(()=>[t.$slots.viewer?(g(),E("div",{key:0},[x(t.$slots,"viewer")])):I("v-if",!0)]),_:2},[t.$slots.progress?{name:"progress",fn:p(_=>[x(t.$slots,"progress",ke(Ie(_)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):I("v-if",!0)],64)):I("v-if",!0)],16))}});var Ea=Oe(Ca,[["__file","image.vue"]]);const $a=Ne(Ea);export{$a as E};
